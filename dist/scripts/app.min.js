angular.module("hashtuber",["ui.router","ngRoute","720kb.socialshare","ngSanitize","angulartics","angulartics.google.analytics"]).constant("Config",{apiBase:"/api/search",colors:["#6caff1","#ff5967","#ff794d","#5082e5","#be5fb6","#33ccbe","#ffaf40","#68bf60","#cccc52","#f279ac","#7870cc","#548899"]}).config(function($stateProvider,$urlRouterProvider,$locationProvider){$stateProvider.state("hashtag",{url:"/search/{hashtag}",templateUrl:"../views/base/_tweets.html",controller:"tweetCtrl",params:{hashtag:{squash:!0}}}).state("home",{url:"/",controller:"homeCtrl",templateUrl:"../views/base/_home.html"}),$urlRouterProvider.otherwise("/"),$locationProvider.html5Mode(!0)}).run(function(randomcolor){randomcolor.setHeaderColor(randomcolor.getRandomColor())}),angular.module("hashtuber").controller("homeCtrl",function($scope,$element,randomcolor){$el=$($element),$info=$el.find("h2"),$info.css("color",randomcolor.getRandomColor())}),angular.module("hashtuber").controller("tweetCtrl",function($scope,$stateParams,$state,$element,randomcolor,middleware){$scope.color=randomcolor.getHeaderColor();var loadMultiLanguage={es:"CARGAR M√ÅS",en:"LOAD MORE"};$scope.loadMore=function(){var userLang=navigator.language||navigator.userLanguage;return userLang.includes("es")||userLang.includes("sp")?loadMultiLanguage.es:loadMultiLanguage.en},$scope.reverse=!1,$scope.sortType="date",$scope.order=function(type,rev){$scope.reverse=rev,$scope.sortType=type},$scope.tweets=[],$scope.$on("EndSearch",function(error,data){$scope.tweets=data.tweets}),$stateParams.hashtag&&middleware.setFilter("hashtag",$stateParams.hashtag),$scope.$on("NewSearch",function(){$state.go("hashtag",{hashtag:middleware.getFilter("hashtag")},{notify:!1,reload:!1})}),middleware.search()}),angular.module("hashtuber").directive("hashheader",function(){return{restrict:"E",replace:!0,templateUrl:"../views/base/hashheader.html",controller:function($scope,middleware,randomcolor,$element,$timeout,$stateParams){var $el=$($element),$input=$el.find("#title");$input.css("color",randomcolor.getHeaderColor()),$scope.search="#"+middleware.getFilter("hashtag"),$input.on("focus",function(){$scope.$apply(function(){$scope.search="#"})}),$input.blur(function(){$scope.$apply(function(){$scope.search="#"+middleware.getFilter("hashtag")})}),$scope.searchHashtag=function(){$scope.search=$scope.search.replace(/ /g,""),$scope.search=$scope.search.replace(/#/g,""),middleware.getFilter("hashtag")!=$scope.search&&(middleware.setFilter("hashtag",$scope.search),middleware.search()),$timeout(function(){$input.blur()},50)},$scope.$on("NewSearch",function(){$scope.search="#"+middleware.getFilter("hashtag")});var shareMultiLenguage={es:"Hazme preguntas, con #HashTuber contesto todas ",en:"#HashTuber a really great tool to play with "};$scope.socialShare=function(){var userLang=navigator.language||navigator.userLanguage;return userLang.includes("es")||userLang.includes("sp")?shareMultiLenguage.es:shareMultiLenguage.en}}}}),angular.module("hashtuber").directive("tweet",function(){return{restrict:"E",replace:!0,scope:{tweet:"="},templateUrl:"../views/base/_tweet.html",controller:function($scope,$element){$el=$($element),$a=$el.find("a"),$a.hover(function(){$(this).css("color",$scope.tweet.color)},function(){$(this).css("color","#262626")})}}}),angular.module("hashtuber").filter("tweetLinky",["$filter",function($filter){return function(text,target){if(!text)return text;var replacedText=$filter("linky")(text,target),targetAttr="";angular.isDefined(target)&&(targetAttr=' target="'+target+'"');var replacePattern1=/(^|\s)#(\w*[a-zA-Z_]+\w*)/gim;replacedText=text.replace(replacePattern1,'$1<a href="https://twitter.com/search?q=%23$2"'+targetAttr+'">#$2</a>');var replacePattern2=/(^|\s)\@(\w*[a-zA-Z_]+\w*)/gim;return replacedText=replacedText.replace(replacePattern2,'$1<a href="https://twitter.com/$2"'+targetAttr+">@$2</a>")}}]),angular.module("hashtuber").service("api",function($http,$q,Config){return{call:function(params,data,callback,method){method=method?method:"GET";var canceler=$q.defer();return $http({url:Config.apiBase,method:method,params:params,timeout:canceler.promise,data:data}).success(function(data,status){"function"==typeof callback&&callback(data)}),{cancel:function(){canceler.resolve()}}}}}),angular.module("hashtuber").service("middleware",function($http,api,$rootScope){var backup=[],filters={hashtag:"HashTuber"},search=function(filters,callback){var params={hashtag:filters.hashtag};return api.call(params,{},function(data){"function"==typeof callback&&callback(data)})};return{search:function(){$rootScope.$broadcast("NewSearch");var question=search(filters,function(data){$rootScope.$broadcast("EndSearch",{tweets:data})});backup.push(question)},setFilter:function(key,value){filters[key]=value},getFilter:function(key){return filters[key]},getAllFilters:function(){return filters},filters:filters}}),angular.module("hashtuber").service("randomcolor",function(Config){var headerColor;return{getRandomColor:function(){var index=Math.floor(Math.random()*Config.colors.length);return Config.colors[index]},setHeaderColor:function(color){headerColor=color},getHeaderColor:function(){return headerColor}}});